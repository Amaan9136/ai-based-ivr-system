<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nearby School Chatbot</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    #chat-box {
      border: 1px solid #ddd;
      height: 400px;
      overflow-y: scroll;
      padding: 15px;
      background: #f9f9f9;
    }
    .message {
      margin-bottom: 15px;
    }
    .user { text-align: right; color: blue; }
    .bot { text-align: left; color: green; }
  </style>
</head>
<body>
<div class="container mt-5">
  <h2>Nearby School Chatbot</h2>
  <div id="chat-box" class="mb-3"></div>

  <form id="chat-form" class="input-group">
    <input type="text" id="promptInput" class="form-control" placeholder="Ask me about schools..." required>
    <button class="btn btn-success" type="submit">Send</button>
  </form>
</div>

<script>
  const chatForm = document.getElementById("chat-form");
  const chatBox = document.getElementById("chat-box");
  let oldSummary = "";

  chatForm.addEventListener("submit", function (e) {
    e.preventDefault();
    const prompt = document.getElementById("promptInput").value.trim();
    if (!prompt) return;

    chatBox.innerHTML += `<div class="message user"><strong>You:</strong> ${prompt}</div>`;
    chatBox.scrollTop = chatBox.scrollHeight;

    fetch("/nearby-schools/api/nearby_school_finder", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        prompt: prompt,
        old_response_summary: oldSummary
      })
    })
      .then(res => res.json())
      .then(data => {
        chatBox.innerHTML += `<div class="message bot"><strong>Bot:</strong> ${data.response}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
        oldSummary = data.old_response_summary; // ðŸ” properly update summary
      })
      .catch(err => {
        chatBox.innerHTML += `<div class="message bot text-danger"><strong>Bot:</strong> Error occurred.</div>`;
      });

    document.getElementById("promptInput").value = "";
  });
</script>

</body>
</html>
